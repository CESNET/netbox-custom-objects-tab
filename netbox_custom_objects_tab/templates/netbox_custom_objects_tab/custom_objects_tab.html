{% extends base_template %}
{% load i18n %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card">

      {# --- header with search form --- #}
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0">{% trans "Custom Objects" %}</h2>
        <form method="get" class="d-flex flex-wrap align-items-center gap-2">
          <div class="input-group input-group-sm">
            <input type="text" name="q" value="{{ q }}"
                   class="form-control" placeholder="{% trans 'Search...' %}"
                   aria-label="{% trans 'Search custom objects' %}">
            <button type="submit" class="btn btn-primary">
              <i class="mdi mdi-magnify"></i>
            </button>
            {% if q or type_slug %}
              <a href="?" class="btn btn-outline-secondary" title="{% trans 'Clear filters' %}">
                <i class="mdi mdi-close"></i>
              </a>
            {% endif %}
          </div>
          {# Type dropdown â€” only shown when there are 2+ types #}
          {% if available_types|length > 1 %}
            <select name="type" class="form-select form-select-sm w-auto"
                    onchange="this.form.submit()" aria-label="{% trans 'Filter by type' %}">
              <option value="">{% trans "All types" %}</option>
              {% for cot in available_types %}
                <option value="{{ cot.slug }}"{% if cot.slug == type_slug %} selected{% endif %}>
                  {{ cot }}
                </option>
              {% endfor %}
            </select>
          {% endif %}
          {# preserve per_page when submitting the search form #}
          {% if request.GET.per_page %}
            <input type="hidden" name="per_page" value="{{ request.GET.per_page }}">
          {% endif %}
        </form>
      </div>

      {# --- top paginator --- #}
      {% include 'inc/paginator.html' with paginator=paginator page=page_obj placement='top' %}

      {# --- table or empty state --- #}
      {% if page_obj.object_list %}
        <div class="table-responsive">
          <table class="table table-hover attr-table mb-0">
            <thead>
              <tr>
                <th>{% trans "Type" %}</th>
                <th>{% trans "Object" %}</th>
                <th>{% trans "Field" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for obj, field in page_obj.object_list %}
                <tr>
                  <td>{{ field.custom_object_type }}</td>
                  <td><a href="{{ obj.get_absolute_url }}">{{ obj }}</a></td>
                  <td>{{ field }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="card-body text-muted">
          {% if q or type_slug %}
            {% trans "No custom objects match your filters." %}
          {% else %}
            {% trans "No custom objects are linked to this object." %}
          {% endif %}
        </div>
      {% endif %}

      {# --- bottom paginator --- #}
      {% include 'inc/paginator.html' with paginator=paginator page=page_obj placement='bottom' %}

    </div>
  </div>
</div>
{% endblock content %}
